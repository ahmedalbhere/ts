<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TS - Trending Shorts</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root {
        --bg: #0d0d0d;
        --text: #ffffff;
        --card: #1a1a1a;
        --accent: #0f9dff;
        --shadow: rgba(0, 0, 0, 0.5);
    }

    body.light {
        --bg: #f6f6f6;
        --text: #111;
        --card: #ffffff;
        --accent: #0077ff;
        --shadow: rgba(0, 0, 0, 0.1);
    }

    * {
        box-sizing: border-box;
    }

    body {
        background: var(--bg);
        color: var(--text);
        font-family: 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 0;
        transition: 0.3s;
        overflow-x: hidden;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± */
    header {
        padding: 12px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--card);
        box-shadow: 0 2px 15px var(--shadow);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .logo-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .logo {
        font-size: 28px;
        font-weight: bold;
        color: var(--accent);
        letter-spacing: 1px;
    }

    .subtitle {
        font-size: 14px;
        opacity: 0.8;
    }

    .controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .toggle-btn, .refresh-btn {
        padding: 8px 14px;
        border-radius: 8px;
        background: var(--accent);
        color: #fff;
        border: none;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .toggle-btn:hover, .refresh-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }

    /* ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª */
    #videos {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        padding: 20px;
        width: 100%;
        max-width: 100%;
    }

    .card {
        background: var(--card);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 12px var(--shadow);
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px var(--shadow);
    }

    .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 177.78%; /* Ù†Ø³Ø¨Ø© 16:9 Ù„Ù„Ø´ÙˆØ±ØªØ§Øª */
        height: 0;
        overflow: hidden;
        background: #000;
    }

    iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 12px;
    }

    .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        gap: 20px;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(15, 157, 255, 0.2);
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .video-info {
        padding: 12px;
        font-size: 14px;
        line-height: 1.4;
    }

    .trending-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: #ff0000;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        z-index: 10;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù„Ù„Ù‡ÙˆØ§ØªÙ */
    @media (max-width: 768px) {
        #videos {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
            padding: 12px;
        }
        
        .logo {
            font-size: 24px;
        }
        
        .subtitle {
            display: none;
        }
        
        .video-info {
            display: none;
        }
    }

    @media (max-width: 480px) {
        #videos {
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        }
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
    .progress-bar {
        height: 4px;
        background: var(--accent);
        width: 0%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 101;
        transition: width 0.3s;
    }
</style>
</head>

<body>
<div class="progress-bar" id="progressBar"></div>

<header>
    <div class="logo-container">
        <div class="logo">TS</div>
        <div class="subtitle">Trending Shorts</div>
    </div>
    
    <div class="controls">
        <button class="refresh-btn" onclick="loadTrending()" id="refreshBtn">
            <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
        </button>
        <button class="toggle-btn" onclick="toggleTheme()">
            <i class="fas fa-sun"></i> / <i class="fas fa-moon"></i>
        </button>
    </div>
</header>

<h2 style="text-align:center;margin:20px 0 10px 0;font-size: 1.5rem;">ğŸ”¥ Ø£Ø­Ø¯Ø« Ø§Ù„ØªØ±Ù†Ø¯ Ù…Ù† ÙƒÙ„ Ù…ÙƒØ§Ù†</h2>

<div id="videos">
    <div class="loading">
        <div class="spinner"></div>
        <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ø´ÙˆØ±ØªØ§Øª...</div>
    </div>
</div>

<script>
// ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
let isLoading = false;
const cacheDuration = 5 * 60 * 1000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚
let lastLoadTime = 0;

// ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
window.addEventListener('scroll', () => {
    const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrolled = (winScroll / height) * 100;
    document.getElementById("progressBar").style.width = scrolled + "%";
});

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
function toggleTheme() {
    document.body.classList.toggle("light");
    localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
async function loadTrending() {
    if (isLoading) return;
    
    const now = Date.now();
    if (now - lastLoadTime < 10000) { // Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªÙƒØ±Ø±
        return;
    }
    
    isLoading = true;
    lastLoadTime = now;
    
    const container = document.getElementById("videos");
    const refreshBtn = document.getElementById("refreshBtn");
    
    container.innerHTML = `
        <div class="loading">
            <div class="spinner"></div>
            <div>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ø´ÙˆØ±ØªØ§Øª...</div>
        </div>
    `;
    
    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«';
    refreshBtn.disabled = true;
    
    try {
        // Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„ØªØ±Ù†Ø¯ (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯)
        const sources = [
            "https://api.allorigins.win/raw?url=https://www.youtube.com/feeds/videos.xml?playlist_id=PLrEnWoR732-BHrPp_Pm8_VleD68f9s14-", // ØªØ±Ù†Ø¯ ÙŠÙˆØªÙŠÙˆØ¨
            "https://api.allorigins.win/raw?url=https://www.youtube.com/feeds/videos.xml?playlist_id=PLirAqAtl_h2r5g8xGajEwdXd3x1sZh8hC", // ØªØ±Ù†Ø¯ Ø¢Ø®Ø±
        ];
        
        let allVideos = [];
        
        // Ø¬Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ
        const promises = sources.map(async (url, index) => {
            try {
                const res = await fetch(url);
                const xml = await res.text();
                const parser = new DOMParser();
                const data = parser.parseFromString(xml, "text/xml");
                const entries = data.getElementsByTagName("entry");
                
                // Ø£Ø®Ø° Ø£ÙˆÙ„ 4 ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ù† ÙƒÙ„ Ù…ØµØ¯Ø±
                for (let i = 0; i < Math.min(4, entries.length); i++) {
                    const link = entries[i].getElementsByTagName("link")[0]?.getAttribute("href");
                    const title = entries[i].getElementsByTagName("title")[0]?.textContent || "ÙÙŠØ¯ÙŠÙˆ ØªØ±Ù†Ø¯";
                    
                    if (link && link.includes("youtube.com")) {
                        allVideos.push({
                            link: link.replace("watch?v=", "embed/"),
                            title: title,
                            source: index
                        });
                    }
                }
            } catch (e) {
                console.warn(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØµØ¯Ø± ${index}:`, e);
            }
        });
        
        await Promise.allSettled(promises);
        
        // Ø®Ù„Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
        allVideos = shuffleArray(allVideos);
        
        // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
        container.innerHTML = '';
        
        if (allVideos.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--accent); margin-bottom: 20px;"></i>
                    <h3>âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h3>
                    <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>
                </div>
            `;
        } else {
            allVideos.forEach(video => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="trending-badge">ğŸ”¥ ØªØ±Ù†Ø¯</div>
                    <div class="video-container">
                        <iframe 
                            src="${video.link}?autoplay=0&modestbranding=1&rel=0" 
                            allowfullscreen 
                            loading="lazy"
                            title="${video.title}">
                        </iframe>
                    </div>
                    <div class="video-info">
                        ${video.title.length > 50 ? video.title.substring(0, 50) + '...' : video.title}
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·ÙŠØ¡ Ù„Ù„ØµÙˆØ±
        document.querySelectorAll('iframe').forEach(iframe => {
            iframe.addEventListener('load', function() {
                this.style.opacity = '1';
            });
        });
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ±Ù†Ø¯:', error);
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                <i class="fas fa-exclamation-circle" style="font-size: 48px; color: #ff4444; margin-bottom: 20px;"></i>
                <h3>âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ±Ù†Ø¯</h3>
                <p>${error.message}</p>
                <button class="toggle-btn" onclick="loadTrending()" style="margin-top: 20px;">
                    <i class="fas fa-redo"></i> Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                </button>
            </div>
        `;
    } finally {
        isLoading = false;
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«';
        refreshBtn.disabled = false;
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'light') {
    document.body.classList.add('light');
}

// Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('DOMContentLoaded', () => {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙˆØ±Ø§Ù‹
    loadTrending();
    
    // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 3 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ù…Ø±Ø¦ÙŠØ©
    setInterval(() => {
        if (!document.hidden && !isLoading) {
            loadTrending();
        }
    }, 3 * 60 * 1000);
});

// ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
document.addEventListener('visibilitychange', () => {
    if (!document.hidden && Date.now() - lastLoadTime > cacheDuration) {
        loadTrending();
    }
});
</script>

</body>
</html>
